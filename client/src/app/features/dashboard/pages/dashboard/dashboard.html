<div class="dashboard-container">
  <app-sidebar 
    [currentView]="currentView"
    (menuItemSelected)="onMenuItemSelected($event)">
  </app-sidebar>
  
  <main class="dashboard-content">
    <!-- Header -->
    <header class="dashboard-header">
      <div class="header-left">
        <h1 class="page-title">
          {{ selectedFolder ? selectedFolder.name : getPageTitle() }}
        </h1>
        <p class="page-subtitle" *ngIf="!selectedFolder">
          {{ getPageSubtitle() }}
        </p>
      </div>
      
      <div class="header-right">
        <div class="header-actions">
          <button class="btn-primary" (click)="createNewLink()" *ngIf="currentView !== 'folders'">
            <i class="fas fa-plus"></i> New Link
          </button>
          <button class="btn-secondary" (click)="createNewFolder()" *ngIf="currentView === 'folders'">
            <i class="fas fa-folder-plus"></i> New Folder
          </button>
        </div>
        
        <!-- Profile Dropdown -->
        <app-profile-dropdown [currentUser]="currentUser"></app-profile-dropdown>
      </div>
    </header>

    <!-- Overview Section -->
    <section *ngIf="currentView === 'overview'" class="overview-section">
      <!-- Stats Cards -->
      <div class="stats-grid" *ngIf="stats && !statsError">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-link"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats.totalLinks }}</h3>
            <p>Total Links</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-mouse-pointer"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats.totalClicks }}</h3>
            <p>Total Clicks</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-folder"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats.totalFolders }}</h3>
            <p>Folders</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-calendar-day"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats.linksCreatedToday }}</h3>
            <p>Created Today</p>
          </div>
        </div>
      </div>

      <!-- Stats Error Message -->
      <div class="error-message-inline" *ngIf="statsError">
        <i class="fas fa-exclamation-triangle"></i>
        <span>{{ statsError }}</span>
        <button class="retry-btn" (click)="loadDashboardData()">
          <i class="fas fa-redo"></i> Retry
        </button>
      </div>

      <!-- Recent Links -->
      <div class="recent-section">
        <div class="section-header">
          <h2>Recent Links</h2>
          <a href="#" (click)="onMenuItemSelected('all-links')" class="view-all">View All</a>
        </div>
        
        <!-- Links Error Message -->
        <div class="error-message-inline" *ngIf="linksError">
          <i class="fas fa-exclamation-triangle"></i>
          <span>{{ linksError }}</span>
          <button class="retry-btn" (click)="loadDashboardData()">
            <i class="fas fa-redo"></i> Retry
          </button>
        </div>
        
        <div class="links-grid" *ngIf="recentLinks.length > 0 && !linksError; else noLinks">
          <app-link-card
            *ngFor="let link of recentLinks"
            [link]="link"
            [showFolder]="true"
            (linkClicked)="onLinkClicked($event)"
            (copyClicked)="onCopyClicked($event)"
            (editClicked)="onEditLinkClicked($event)"
            (deleteClicked)="onDeleteLinkClicked($event)"
            (qrClicked)="onQrClicked($event)">
          </app-link-card>
        </div>
      </div>
    </section>

    <!-- All Links Section -->
    <section *ngIf="currentView === 'all-links' || currentView === 'folder-links'" class="links-section">
      <div class="section-filters">
        <div class="search-bar">
          <i class="fas fa-search"></i>
          <input type="text" placeholder="Search links..." #searchInput>
        </div>
        
        <div class="filter-controls">
          <select class="filter-select">
            <option value="">All Folders</option>
            <option *ngFor="let folder of folders" [value]="folder.id">{{ folder.name }}</option>
          </select>
          
          <select class="filter-select">
            <option value="">Sort by Date</option>
            <option value="clicks">Sort by Clicks</option>
            <option value="title">Sort by Title</option>
          </select>
        </div>
      </div>
      
      <div class="links-grid" *ngIf="getLinksForView().length > 0; else noLinks">
        <app-link-card
          *ngFor="let link of getLinksForView()"
          [link]="link"
          [showFolder]="currentView !== 'folder-links'"
          (linkClicked)="onLinkClicked($event)"
          (copyClicked)="onCopyClicked($event)"
          (editClicked)="onEditLinkClicked($event)"
          (deleteClicked)="onDeleteLinkClicked($event)"
          (qrClicked)="onQrClicked($event)">
        </app-link-card>
      </div>
    </section>

    <!-- Folders Section -->
    <section *ngIf="currentView === 'folders'" class="folders-section">
      <div class="folders-grid" *ngIf="folders.length > 0; else noFolders">
        <app-folder-card
          *ngFor="let folder of folders"
          [folder]="folder"
          (folderClicked)="onFolderClicked($event)"
          (editClicked)="onEditFolderClicked($event)"
          (deleteClicked)="onDeleteFolderClicked($event)">
        </app-folder-card>
      </div>
    </section>

    <!-- Profile Section -->
    <section *ngIf="currentView === 'profile'" class="profile-section">
      <div class="profile-card">
        <div class="profile-avatar">
          <i class="fas fa-user"></i>
        </div>
        <div class="profile-info">
          <h2>John Doe</h2>
          <p>john.doe&#64;example.com</p>
          <span class="member-since">LinkHub member since July 2025</span>
        </div>
      </div>
      
      <div class="profile-stats">
        <div class="profile-stat">
          <h3>Account Statistics</h3>
          <div class="stat-items">
            <div class="stat-item">
              <span>Total Links Created:</span>
              <strong>{{ stats?.totalLinks || 0 }}</strong>
            </div>
            <div class="stat-item">
              <span>Total Clicks:</span>
              <strong>{{ stats?.totalClicks || 0 }}</strong>
            </div>
            <div class="stat-item">
              <span>Folders Created:</span>
              <strong>{{ stats?.totalFolders || 0 }}</strong>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Profile Section -->
    <section *ngIf="currentView === 'profile'" class="profile-section">
      <app-profile></app-profile>
    </section>

    <!-- Settings Section -->
    <section *ngIf="currentView === 'settings'" class="settings-section">
      <app-settings></app-settings>
    </section>

    <!-- Empty States -->
    <ng-template #noLinks>
      <div class="empty-state">
        <div class="empty-icon">
          <i class="fas fa-link"></i>
        </div>
        <h3>No links yet</h3>
        <p>Create your first shortened link to get started!</p>
        <button class="btn-primary" (click)="createNewLink()">
          <i class="fas fa-plus"></i> Create Link
        </button>
      </div>
    </ng-template>

    <ng-template #noFolders>
      <div class="empty-state">
        <div class="empty-icon">
          <i class="fas fa-folder"></i>
        </div>
        <h3>No folders yet</h3>
        <p>Organize your links by creating folders!</p>
        <button class="btn-primary" (click)="createNewFolder()">
          <i class="fas fa-folder-plus"></i> Create Folder
        </button>
      </div>
    </ng-template>
  </main>
  
  <!-- URL Form Modal -->
  <div class="modal-overlay" *ngIf="showUrlForm" (click)="onCancelUrlForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Create New Link</h3>
        <button class="modal-close" (click)="onCancelUrlForm()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <app-url-form 
          #urlFormRef
          [isCompact]="true"
          (urlSubmitted)="onUrlSubmitted($event)">
        </app-url-form>
      </div>
    </div>
  </div>

  <!-- Folder Dialog -->
  <app-folder-dialog
    [isVisible]="showFolderDialog"
    [isEditing]="folderDialogMode === 'edit'"
    [initialData]="editingFolder"
    (folderCreated)="onFolderCreated($event)"
    (folderUpdated)="onFolderUpdated($event)"
    (cancelled)="onFolderDialogClosed()">
  </app-folder-dialog>

  <!-- Confirmation Dialog -->
  <app-confirmation-dialog
    *ngIf="showConfirmDialog"
    [title]="confirmDialogTitle"
    [message]="confirmDialogMessage"
    confirmText="Delete"
    cancelText="Cancel"
    (closed)="onConfirmDialogClosed()"
    (confirmed)="onConfirmDialogConfirmed()">
  </app-confirmation-dialog>
</div>
